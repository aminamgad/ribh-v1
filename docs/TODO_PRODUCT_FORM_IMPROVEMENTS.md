# قائمة مهام: تحسين صفحة إضافة/تعديل المنتج (صفحة واحدة)

## الهدف
- دمج صفحتي **إضافة منتج** و**تعديل منتج** في **صفحة واحدة** تعمل في وضعين (وضع إنشاء / وضع تعديل).
- تبسيط تجربة المستخدم وتحسين واجهة المستخدم (UI/UX).
- تقليل التعقيد (حذف الخطوات غير الضرورية، نموذج أوضح).

---

## 1. دمج الصفحتين في صفحة واحدة

| # | المهمة | الوصف | الأولوية |
|---|--------|--------|----------|
| 1.1 | **إنشاء مسار موحد** | إنشاء مسار مثل `/dashboard/products/[[...id]]/edit` أو `/dashboard/products/[id]` حيث `id` اختياري: غياب `id` = إضافة، وجود `id` = تعديل. | عالية |
| 1.2 | **مكون نموذج مشترك** | استخراج منطق النموذج (react-hook-form، التحقق، الحفظ، الجلب) إلى مكون واحد قابل لإعادة الاستخدام (مثلاً `ProductForm`) يُستدعى من صفحة واحدة. | عالية |
| 1.3 | **تحديث الروابط** | استبدال كل من `/dashboard/products/new` و `/dashboard/products/[id]/edit` برابط الصفحة الموحدة في: قائمة المنتجات، لوحة التحكم، الشريط الجانبي، BottomNavBar، إلخ. | عالية |
| 1.4 | **إعادة التوجيه (Redirect)** | إذا بقي مسارا `new` و `[id]/edit` لأسباب توافقية، جعلهما يعيدان التوجيه إلى الصفحة الموحدة. | متوسطة |

---

## 2. تبسيط هيكل النموذج وواجهة المستخدم

| # | المهمة | الوصف | الأولوية |
|---|--------|--------|----------|
| 2.1 | **تقليل الخطوات أو إلغاء الويزارد** | حالياً 5 خطوات (أساسي، وسائط، أسعار، متغيرات، مراجعة). خيارات: (أ) تحويل إلى نموذج واحد قابل للتمرير مع أقسام واضحة (بدون ويزارد)، أو (ب) تقليل إلى 2–3 خطوات فقط. | عالية |
| 2.2 | **نموذج واحد بأقسام قابلة للطي (Accordion)** | عرض كل المحتوى في صفحة واحدة مع أقسام: المعلومات الأساسية، الوسائط، الأسعار والمخزون، المتغيرات. كل قسم قابل للفتح/الإغلاق مع مؤشر إكمال (اختياري). | عالية |
| 2.3 | **إزالة التكرار بين new و edit** | توحيد حالة النموذج (state)، دوال الجلب/الحفظ، والتحقق بين وضع الإضافة والتعديل لتجنب نسخ الكود. | عالية |
| 2.4 | **تبسيط حقول اختيار الفئة والمورد** | استبدال القوائم المنسدلة المعقدة (مع بحث منفصل) بمكونات أبسط: قائمة منسدلة عادية أو Combobox واحد مع بحث مدمج. | متوسطة |
| 2.5 | **حقول اختيارية واضحة** | تمييز الحقول الإلزامية عن الاختيارية (نص أو أيقونة)، وإخفاء أو جعل الحقول المتقدمة (مثل سعر الجملة، السعر الأدنى الإلزامي) قابلة للظهور تحت "المزيد" لتقليل الازدحام. | متوسطة |

---

## 3. تحسين واجهة المستخدم (UI)

| # | المهمة | الوصف | الأولوية |
|---|--------|--------|----------|
| 3.1 | **شريط عنوان وعودة ثابت** | شريط علوي بسيط: عنوان "منتج جديد" أو "تعديل المنتج"، زر عودة لقائمة المنتجات، وزر حفظ واحد واضح. | عالية |
| 3.2 | **تحميل وحفظ واضح** | حالة تحميل أولية عند التعديل (skeleton أو spinner)، وزر حفظ مع حالة (عادي / جاري الحفظ / تم) وعدم إمكانية double-submit. | عالية |
| 3.3 | **عرض الصور بشكل أبسط** | شبكة صور واضحة مع إمكانية السحب للإعادة ترتيب، تحديد الصورة الرئيسية بنقرة واحدة، حذف بصري واضح. | متوسطة |
| 3.4 | **متغيرات المنتج (Variants)** | واجهة مبسطة للمتغيرات: إما جدول مضغوط أو بطاقات، مع أزرار "إضافة متغير" و"حذف" واضحة وتنبيه قبل الحذف. | متوسطة |
| 3.5 | **تنبيهات ورسائل خطأ متسقة** | عرض أخطاء التحقق تحت الحقل مباشرة، واستخدام نفس نمط الـ toasts للنجاح/الفشل. إزالة أي modals معقدة غير ضرورية. | متوسطة |
| 3.6 | **دعم RTL والوصولية** | التأكد من أن التخطيط والألوان والتباين يعملان جيداً مع RTL وقراءة الشاشة إن أمكن. | منخفضة |

---

## 4. تحسين تجربة المستخدم (UX)

| # | المهمة | الوصف | الأولوية |
|---|--------|--------|----------|
| 4.1 | **حفظ تلقائي (اختياري)** | إبقاء أو تبسيط الحفظ التلقائي للمسودات في وضع التعديل فقط، مع تنبيه بسيط عند مغادرة الصفحة إذا وجدت تغييرات غير محفوظة. | متوسطة |
| 4.2 | **تنبيه عند المغادرة** | استخدام مثلاً `beforeunload` أو تحذير في الـ router عند الخروج مع وجود تغييرات غير محفوظة. | عالية |
| 4.3 | **رسائل نجاح/فشل واضحة** | بعد الحفظ: "تم إنشاء المنتج" أو "تم تحديث المنتج" مع زر للانتقال إلى المنتج أو إلى القائمة. | عالية |
| 4.4 | **تبسيط التحقق من الاسم و SKU** | إبقاء التحقق من تكرار الاسم و SKU في الخلفية مع عرض تحذير بسيط تحت الحقل دون إرباك المستخدم. | متوسطة |
| 4.5 | **إزالة أو دمج الميزات الزائدة** | مراجعة الميزات الموجودة (قوالب، وضع ملء الشاشة، وضع التحرير السريع، إلخ) وإزالة ما لا يُستخدم أو دمجه في تدفق واحد بسيط. | متوسطة |

---

## 5. تقنيات وكود

| # | المهمة | الوصف | الأولوية |
|---|--------|--------|----------|
| 5.1 | **استخراج الـ hooks** | نقل منطق الجلب، الحفظ، التحقق، المتغيرات، الوسائط إلى custom hooks (مثل `useProductForm`, `useProductSubmit`) لتقليل حجم الصفحة وتبسيط القراءة. | عالية |
| 5.2 | **مكونات فرعية للنموذج** | تقسيم النموذج إلى مكونات: `ProductBasicFields`, `ProductMediaSection`, `ProductPricingSection`, `ProductVariantsSection` لاستخدامها في الصفحة الموحدة. | عالية |
| 5.3 | **توحيد الـ schema والتحقق** | استخدام نفس `productSchema` (zod) وقواعد التحقق في وضعي الإضافة والتعديل، مع معامل اختياري لـ `excludeId` عند التحقق من الاسم/SKU. | عالية |
| 5.4 | **تبسيط الـ state** | تقليل عدد حالات الـ useState حيث أمكن (دمج حالات مرتبطة، استخدام useReducer إن لزم) لتحسين الوضوح. | متوسطة |
| 5.5 | **حذف أو دمج الملفات القديمة** | بعد نجاح الصفحة الموحدة، حذف أو إعادة توجيه `app/dashboard/products/new/page.tsx` و `app/dashboard/products/[id]/edit/page.tsx` حسب الخيار المختار في 1.4. | عالية |

---

## 6. ترتيب تنفيذ مقترح

1. **المرحلة 1 – الهيكل**
   - 1.2 (مكون نموذج مشترك) + 5.1 (hooks) + 5.2 (مكونات فرعية)
   - 1.1 (مسار موحد) + 1.3 (تحديث الروابط)

2. **المرحلة 2 – التبسيط**
   - 2.1 و 2.2 (إلغاء/تقليل الويزارد، نموذج بأقسام)
   - 2.3 (إزالة التكرار) + 5.3 (توحيد schema)

3. **المرحلة 3 – الواجهة والتجربة**
   - 3.1، 3.2، 4.2، 4.3 (شريط، حفظ، تنبيه مغادرة، رسائل)
   - 2.4، 2.5، 3.3، 3.4، 3.5 (تبسيط حقول، صور، متغيرات، أخطاء)

4. **المرحلة 4 – التشذيب**
   - 4.1، 4.4، 4.5، 3.6، 5.4، 5.5 (حفظ تلقائي، تحقق، إزالة زوائد، RTL، state، حذف ملفات)

---

## ملاحظات

- الصفحتان الحاليتان (`new` و `edit`) كبيرتان جداً (آلاف الأسطر). الهدف هو تقليل التعقيد وعدم نسخ المنطق.
- يمكن الاحتفاظ بجزء من منطق "المراجعة" كقسم آخر قابل للطي يعرض ملخصاً قبل الحفظ بدلاً من خطوة منفصلة.
- يفضّل عدم إضافة ميزات جديدة حتى استقرار الصفحة الموحدة والـ UI/UX المبسطة.
