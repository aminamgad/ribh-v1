# ๐ฆ ุฏููู ุงูุชูุงูู ุงูุชููุงุฆู ุจูู ุงูุทูุจุงุช ูุดุฑูุฉ ุงูุดุญู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ุขููุฉ ุชููุงุฆูุฉ ูุชุญููู ุงูุทูุจุงุช (Orders) ุฅูู ุทุฑูุฏ (Packages) ูุดุฑูุฉ ุงูุดุญู ุนูุฏ ุฌุงูุฒูุฉ ุงูุทูุจ ููุดุญู.

---

## โ ุงูููุฒุงุช ุงููุถุงูุฉ

### 1. **ุงูุชุญููู ุงูุชููุงุฆู**
- ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ ุฅูู `ready_for_shipping`ุ ูุชู ุฅูุดุงุก Package ุชููุงุฆูุงู ูุดุฑูุฉ ุงูุดุญู
- ูุชู ุฑุจุท Package ุจุงูู Order ุนุจุฑ `orderId` ู `packageId`

### 2. **ุงูุฑุจุท ุจูู Order ู Package**
- **Order Model**: ูุญุชูู ุนูู `packageId` (ุฑูู ุงูุทุฑุฏ)
- **Package Model**: ูุญุชูู ุนูู `orderId` (ูุนุฑู ุงูุทูุจ)

### 3. **ุฅุนุฏุงุฏุงุช ุงููุธุงู**
- **defaultExternalCompanyId**: ุงูุดุฑูุฉ ุงูุฎุงุฑุฌูุฉ ุงูุงูุชุฑุงุถูุฉ ูู SystemSettings
- **autoCreatePackages**: ุชูุนูู/ุชุนุทูู ุงูุฅูุดุงุก ุงูุชููุงุฆู (ุงูุชุฑุงุถูุงู: `true`)
  - โ `true`: Package ูุชู ุฅูุดุงุคู **ููุฑุงู ุนูุฏ ุฅูุดุงุก Order** (ุงูุงูุชุฑุงุถู)
  - โ `false`: Package ูุชู ุฅูุดุงุคู ููุท ุนูุฏ `ready_for_shipping`
- **createPackageOnOrderCreate**: ููุณ `autoCreatePackages` (ููุชูุงูู)

---

## ๐ง ุงูุฅุนุฏุงุฏ ุงูุฃููู

### 1. ุฅูุดุงุก ุดุฑูุฉ ุดุญู ุฎุงุฑุฌูุฉ

```bash
node scripts/create-external-company.js "ุดุฑูุฉ ุงูุดุญู ุงูุณุฑูุน"
```

**ุงุญูุธ API Key ู API Secret** - ุณุชุญุชุงุฌูู ูุงุญูุงู.

### 2. ุชุนููู ุงูุดุฑูุฉ ุงูุงูุชุฑุงุถูุฉ (ุงุฎุชูุงุฑู)

ููููู ุชุนููู ุงูุดุฑูุฉ ุงูุงูุชุฑุงุถูุฉ ูู ุฎูุงู:
- **SystemSettings**: ุฅุถุงูุฉ `defaultExternalCompanyId` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุฃู**: ุงููุธุงู ุณูุณุชุฎุฏู ุฃูู ุดุฑูุฉ ูุดุทุฉ ูุงูุชุฑุงุถูุฉ

---

## ๐ ููู ูุนูู ุงููุธุงู

### ุงูุณููุงุฑูู ุงูุชููุงุฆู (ุงูุงูุชุฑุงุถู):

**โ๏ธ ุงูุชุฑุงุถูุงู: ุงูุทูุจ ูุตู ูุดุฑูุฉ ุงูุดุญู ููุฑุงู ุนูุฏ ุฅูุดุงุฆู!**

1. **ุฅูุดุงุก ุงูุทูุจ** โ Order status: `pending`
   - โ **ููุง ูุชู ุฅูุดุงุก Package ุชููุงุฆูุงู ููุฑุงู**
   - ูุชู ุฑุจุท Package ุจุงูู Order
   - ูุชู ุฅุฑุณุงู Package ูุดุฑูุฉ ุงูุดุญู ูุจุงุดุฑุฉ
   - **ุงูุทูุจ ูุตู ูุดุฑูุฉ ุงูุดุญู ุฃูู ูุง ูุชู!**

2. **ุชุฃููุฏ ุงูุทูุจ** โ Order status: `confirmed`
3. **ูุนุงูุฌุฉ ุงูุทูุจ** โ Order status: `processing`
4. **ุฌุงูุฒ ููุดุญู** โ Order status: `ready_for_shipping`
   - ุฅุฐุง ูู ููู Package ููุฌูุฏุงูุ ูุชู ุฅูุดุงุคู ููุง

### ุงูุณููุงุฑูู ุงูุจุฏูู (ุฅุฐุง ุชู ุชุนุทูู autoCreatePackages):

1. **ุฅูุดุงุก ุงูุทูุจ** โ Order status: `pending`
2. **ุชุฃููุฏ ุงูุทูุจ** โ Order status: `confirmed`
3. **ูุนุงูุฌุฉ ุงูุทูุจ** โ Order status: `processing`
4. **ุฌุงูุฒ ููุดุญู** โ Order status: `ready_for_shipping`
   - โ **ููุง ูุชู ุฅูุดุงุก Package ุชููุงุฆูุงู**
   - ูุชู ุฑุจุท Package ุจุงูู Order
   - ูุชู ุฅุฑุณุงู Package ูุดุฑูุฉ ุงูุดุญู

### ุงูููุงุท ุงูุชู ูุชู ูููุง ุฅูุดุงุก Package:

1. **โ ููุฑุงู ุนูุฏ ุฅูุดุงุก ุงูุทูุจ (ุงูุชุฑุงุถู)**
   - ูู `/api/orders` (POST) - ุนูุฏ ุฅูุดุงุก Order ุฌุฏูุฏ
   - ูุชู ุฅูุดุงุก Package ุชููุงุฆูุงู ุฅุฐุง ูุงู `autoCreatePackages: true`
   - **ูุฐุง ูุนูู: ุงูุทูุจ ูุตู ูุดุฑูุฉ ุงูุดุญู ุฃูู ูุง ูุชู!**

2. **ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ ุฅูู `ready_for_shipping`**
   - ูู `/api/orders/[id]` (PUT)
   - ูู `/api/orders/[id]/fulfill` (POST)
   - ูู `/api/fulfillment/[id]` (ุนูุฏ ุงูุชูุงู Fulfillment)
   - ูุชู ุฅูุดุงุก Package ููุง ุฅุฐุง ูู ููู ููุฌูุฏุงู ูุณุจูุงู

3. **ุนูุฏ ุดุญู ุงูุทูุจ ูุจุงุดุฑุฉ (`shipped`)**
   - ุฅุฐุง ูู ููู Package ููุฌูุฏุงูุ ูุชู ุฅูุดุงุคู ุชููุงุฆูุงู
   - ูู `/api/orders/[id]` (PUT)
   - ูู `/api/orders/[id]/fulfill` (POST)
   - ูู `/api/admin/orders/manage` (Bulk operations)

---

## ๐ ุงูุจูุงูุงุช ุงููุทููุจุฉ

ููู ูุนูู ุงููุธุงู ุจุดูู ุตุญูุญุ ูุฌุจ ุฃู ูุญุชูู Order ุนูู:

### โ ูุชุทูุจุงุช ุฅูุฒุงููุฉ:
- `shippingAddress.villageId` - ูุนุฑู ุงููุฑูุฉ (ูุทููุจ)
- `shippingAddress.fullName` - ุงุณู ุงููุณุชูู
- `shippingAddress.phone` - ุฑูู ุงููุงุชู
- `shippingAddress.street` - ุนููุงู ุงูุดุงุฑุน

### โ ูุชุทูุจุงุช ุงุฎุชูุงุฑูุฉ:
- `deliveryNotes` - ููุงุญุธุงุช ุงูุชูุตูู
- `items` - ูุงุฆูุฉ ุงูููุชุฌุงุช (ูุฅูุดุงุก ุงููุตู)

---

## ๐ ููููุฉ ุงูุชุญูู ูู ุฃู ุงูุทูุจ ูุตู ูุดุฑูุฉ ุงูุดุญู

### 1. **ูู Order**
```javascript
// GET /api/orders/[id]
{
  "orderNumber": "ORD-12345",
  "packageId": 1234,  // โ ุฅุฐุง ูุงู ููุฌูุฏุงูุ ูุนูู Package ุชู ุฅูุดุงุคู
  "status": "ready_for_shipping"
}
```

### 2. **ูู Package**
```javascript
// ุงูุจุญุซ ุนู Package ุจุฑูู ุงูุทูุจ
// GET /api/packages?orderId=ORDER_ID
{
  "packageId": 1234,
  "orderId": "ORDER_ID",  // โ ูุฑุชุจุท ุจุงูุทูุจ
  "status": "pending",
  "barcode": "PKG-ORD-12345-1234567890"
}
```

### 3. **ูู Logs**
```javascript
// ุงูุจุญุซ ูู logs ุนู:
"Package created from order automatically"
// ุฃู
"Package created successfully from order"
```

---

## ๐๏ธ API Endpoints

### ุฅูุดุงุก Package ูุฏููุงู ูู Order

```bash
POST /api/orders/[id]/create-package
Authorization: Bearer <ADMIN_TOKEN>
```

**Response:**
```json
{
  "success": true,
  "packageId": 1234,
  "message": "Package created successfully"
}
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ๏ธ ูุชู ูุง ูุชู ุฅูุดุงุก Package ุชููุงุฆูุงู:

1. **ูุง ุชูุฌุฏ ุดุฑูุฉ ุดุญู ูุดุทุฉ**
   - ูุฌุจ ุฅูุดุงุก ExternalCompany ุฃููุงู
   - ูุฌุจ ุฃู ุชููู `isActive: true`

2. **ุงูุทูุจ ูุง ูุญุชูู ุนูู `villageId`**
   - ูุฌุจ ุงูุชุฃูุฏ ูู ุฃู `shippingAddress.villageId` ููุฌูุฏ

3. **Package ููุฌูุฏ ูุณุจูุงู**
   - ุฅุฐุง ูุงู Package ููุฌูุฏุงู ููุทูุจุ ูู ูุชู ุฅูุดุงุก ูุงุญุฏ ุฌุฏูุฏ
   - ุณูุชู ุฅุฑุฌุงุน Package ุงูููุฌูุฏ

4. **ุญุงูุฉ ุงูุทูุจ ุบูุฑ ููุงุณุจุฉ**
   - Package ูุชู ุฅูุดุงุคู ููุท ุนูุฏ `ready_for_shipping` ุฃู `shipped`

### โ ุฃูุถู ุงูููุงุฑุณุงุช:

1. **ุชุฃูุฏ ูู ูุฌูุฏ ุดุฑูุฉ ุดุญู ูุดุทุฉ**
   ```bash
   # ุงูุชุญูู ูู ุงูุดุฑูุงุช ุงููุดุทุฉ
   db.externalcompanies.find({ isActive: true })
   ```

2. **ุชุฃูุฏ ูู ุงุณุชูุฑุงุฏ ุงููุฑู**
   ```bash
   node scripts/import-villages.js
   ```

3. **ุฑุงูุจ Logs**
   - ุงุจุญุซ ุนู `Package created from order automatically`
   - ุงุจุญุซ ุนู `Error creating package from order`

4. **ุชุญูู ูู Package ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
   ```javascript
   // MongoDB
   db.packages.find({ orderId: ObjectId("ORDER_ID") })
   ```

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

```
1. Order Created (pending)
   โ
2. Order Confirmed (confirmed)
   โ
3. Order Processing (processing)
   โ
4. Order Ready for Shipping (ready_for_shipping)
   โโโ โ Package Created Automatically
       โโโ Package sent to Shipping Company
   โ
5. Order Shipped (shipped)
   โโโ Package status: shipped
   โ
6. Order Delivered (delivered)
   โโโ Package status: delivered
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: Package ูู ูุชู ุฅูุดุงุคู

**ุงูุชุญูู:**
1. โ ูู ููุฌุฏ ExternalCompany ูุดุทุ
2. โ ูู Order ูุญุชูู ุนูู `villageId`ุ
3. โ ูู ุญุงูุฉ ุงูุทูุจ `ready_for_shipping` ุฃู `shipped`ุ
4. โ ุชุญูู ูู Logs ููุฃุฎุทุงุก

**ุงูุญู:**
```bash
# ุฅูุดุงุก Package ูุฏููุงู
POST /api/orders/[ORDER_ID]/create-package
```

### ุงููุดููุฉ: Package ุชู ุฅูุดุงุคู ููู ูู ูุตู ูุดุฑูุฉ ุงูุดุญู

**ุงูุชุญูู:**
1. โ ุชุญูู ูู ุฃู Package ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. โ ุชุญูู ูู `externalCompanyId` ูู Package
3. โ ุชุญูู ูู ุฃู ุงูุดุฑูุฉ ุงูุฎุงุฑุฌูุฉ ูุดุทุฉ

**ุงูุญู:**
- Package ููุฌูุฏ ูู ุงููุธุงู
- ุดุฑูุฉ ุงูุดุญู ูุฌุจ ุฃู ุชุณุชุฏุนู API ูุงุณุชูุงู ุงูุทุฑูุฏ ุงูุฌุฏูุฏุฉ
- ุฃู ูููู ุฅุถุงูุฉ Webhook ูุฅุฑุณุงู Package ุชููุงุฆูุงู

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู Logs ูู `/lib/order-to-package.ts`
2. ุชุญูู ูู ุฃู ุฌููุน ุงููุชุทูุจุงุช ููุฌูุฏุฉ
3. ุฑุงุฌุน ูุฐุง ุงูุฏููู ูุฑุฉ ุฃุฎุฑู

---

**ุชู ุงูุชุญุฏูุซ:** 2024
**ุงูุฅุตุฏุงุฑ:** 1.0

